<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>動画と音声の同期</title>
    <style>
        body {
            margin: 0;
            height: 100vh;
            overflow: hidden;
            background-color: black;
            cursor: none; /* 初期状態でカーソル非表示 */
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }

        audio {
            display: none;
        }
    </style>
</head>
<body>
    <video id="video" muted loop playsinline>
        <source src="mikufull.mp4" type="video/mp4">
        お使いのブラウザは video タグに対応していません。
    </video>

    <audio id="audio" loop>
        <source src="miku.mp3" type="audio/mp3">
        お使いのブラウザは audio タグに対応していません。
    </audio>

    <script>
        window.onload = function () {
            const video = document.getElementById('video');
            const audio = document.getElementById('audio');

            // フルスクリーン対応（プレフィックス込み）
            function requestFullscreen(elem) {
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.mozRequestFullScreen) {
                    elem.mozRequestFullScreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                }
            }

            function isFullscreen() {
                return document.fullscreenElement ||
                       document.webkitFullscreenElement ||
                       document.mozFullScreenElement ||
                       document.msFullscreenElement;
            }

            function updateCursorVisibility() {
                if (isFullscreen()) {
                    document.body.style.cursor = 'none';
                } else {
                    document.body.style.cursor = '';
                }
            }

            // 全てのフルスクリーンイベントに対応
            ['fullscreenchange', 'webkitfullscreenchange', 'mozfullscreenchange', 'MSFullscreenChange'].forEach(event => {
                document.addEventListener(event, updateCursorVisibility);
            });

            // 全画面中にマウス動かしてもカーソルは非表示のまま
            document.addEventListener('mousemove', function () {
                if (isFullscreen()) {
                    document.body.style.cursor = 'none';
                }
            });

            // クリックで再生 & 全画面開始
            document.body.addEventListener('click', function () {
                video.play().catch(console.error);
                audio.play().catch(console.error);
                requestFullscreen(video);
            });

            // 動画と音声の同期（1秒ごとに確認）
            setInterval(() => {
                const diff = Math.abs(video.currentTime - audio.currentTime);
                if (diff > 0.5) {
                    console.log(`同期修正: 動画=${video.currentTime}, 音声=${audio.currentTime}`);
                    audio.currentTime = video.currentTime;
                }
            }, 1000);
        };
    </script>
</body>
</html>
