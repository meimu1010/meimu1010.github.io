<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>miku hacking</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: black;
      overflow: hidden;
      cursor: none; /* 初期状態で非表示 */
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <video id="video" autoplay loop playsinline>
    <source src="mikufull.mp4" type="video/mp4" />
    お使いのブラウザは video タグに対応していません。
  </video>

  <script>
    window.onload = function () {
      const video = document.getElementById('video');

      function requestFullscreen(elem) {
        if (elem.requestFullscreen) {
          elem.requestFullscreen();
        } else if (elem.webkitRequestFullscreen) {
          elem.webkitRequestFullscreen();
        } else if (elem.mozRequestFullScreen) {
          elem.mozRequestFullScreen();
        } else if (elem.msRequestFullscreen) {
          elem.msRequestFullscreen();
        }
      }

      function isFullscreen() {
        return (
          document.fullscreenElement ||
          document.webkitFullscreenElement ||
          document.mozFullScreenElement ||
          document.msFullscreenElement
        );
      }

      // クリックで再生＆フルスクリーン
      document.body.addEventListener('click', () => {
        video.play().catch(console.error);
        requestFullscreen(video);
      });

      // ESC 判定用のタイマー
      let escTimer = null;

      document.addEventListener('keydown', function (e) {
        // ESC 短押しブロック
        if (e.key === "Escape" && !e.repeat) {
          e.preventDefault();
          e.stopPropagation();
          console.log("ESC（短押し）がブロックされました");
          escTimer = setTimeout(() => {
            escTimer = null; // 長押し判定に移行
          }, 300); // 0.3秒以内は短押し扱い
        }

        // F12
        if (e.key === "F12") {
          e.preventDefault();
          e.stopPropagation();
          console.log("F12 がブロックされました");
        }

        // Ctrl+Shift+I
        if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'i') {
          e.preventDefault();
          e.stopPropagation();
          console.log("Ctrl+Shift+I がブロックされました");
        }

        // Ctrl+Shift+J
        if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'j') {
          e.preventDefault();
          e.stopPropagation();
          console.log("Ctrl+Shift+J がブロックされました");
        }

        // Ctrl+U
        if (e.ctrlKey && e.key.toLowerCase() === 'u') {
          e.preventDefault();
          e.stopPropagation();
          console.log("Ctrl+U がブロックされました");
        }
      });

      // ESC 長押し時は許可
      document.addEventListener("keyup", (e) => {
        if (e.key === "Escape" && escTimer) {
          clearTimeout(escTimer);
          escTimer = null;
        }
      });

      // フルスクリーン解除監視 → 遅延して再フルスクリーン
      document.addEventListener("fullscreenchange", () => {
        if (!isFullscreen() && !escTimer) {
          console.log("フルスクリーン解除を検知 → 遅延して再フルスクリーン");
          setTimeout(() => {
            requestFullscreen(video);
          }, 200); // 0.2秒遅延
        }
      });

      // 右クリック無効化
      document.addEventListener('contextmenu', function (e) {
        e.preventDefault();
        console.log("右クリックがブロックされました");
      });
    };
  </script>
</body>
</html>
